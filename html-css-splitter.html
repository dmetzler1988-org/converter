<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>HTML remove inline style</title>
        <style type="text/css">
            main {
                display: block;
                width: 90%;
                margin: 40px auto;
            }
            textarea {
                display: block;
                width: 100%;
                margin: 20px 0;
            }
        </style>
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
                integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E="
                crossorigin="anonymous">
        </script>
    </head>
    <body>
        <main>
            <a href="https://html-cleaner.com/" target="_blank">https://html-cleaner.com/</a>

            <textarea id="input" rows="20">
                <h2><span style="color: #4b67a1;">This is a demo</span> - <span style="color: #008000;">You can edit the text! <img src="/images/smiley.png" alt="laughing" /> ♥</span></h2>
                <p>Type in the <strong>visual editor</strong> on the left or the <strong>source editor</strong> on the right and see them both change in real time.</p>
                <p>Set up the cleaning preferences below and click the <strong style="box-shadow: 3px 3px 3px #aaa; border-radius: 5px; padding: 0 5px; background-color: #2b3a56; color: #fff;"> Clean HTML</strong> button to clean the HTML source code.</p>
                <!--This is just a comment above the table...-->
                <table class="demoTable" cellpadding="10">
                    <tbody>
                    <tr style="text-align: center;">
                        <td><img src="/images/document-editors.png" alt="editors" /></td>
                        <td><img src="/images/cleaning-arrow.png" alt="cleaning" /></td>
                        <td><img src="/images/clean-html.png" alt="editors" width="86" height="122" /></td>
                    </tr>
                    <tr>
                        <td colspan="3"><strong>Convert almost any document to clean HTML in three simple steps:</strong>
                            <ol>
                                <li>Paste the content of the Document in the editor</li>
                                <li>Click the Clean HTML (optional)</li>
                                <li>Copy the generated HTML code</li>
                            </ol>
                        </td>
                    </tr>
                    </tbody>
                </table>
                <p><strong><span style="color: #366691; font-size: 20px; text-shadow: 4px 10px 4px #888;">      HTML-Cleaner.com</span></strong></p>
                <p>Please find below all the cleaning preferences, the Find And Replace tool, the Lorem-ipsum generator, the <a href="https://html-cleaner.com/case-converter/">Case Converter</a> and much more!</p>
                <p>Don't forget to save this link into your bookmarks and share it with your friends.</p>
            </textarea>
            <button id="convert" type="button">Convert</button>
            <textarea id="outputHtml" rows="20"></textarea>
            <textarea id="outputCss" rows="20"></textarea>
        </main>

        <script type="application/javascript">
            $(document).ready(function() {
                const $input = $('#input');
                const $outputHtml = $('#outputHtml');
                const $outputCss = $('#outputCss');
                const $button = $('#convert');
                const regexCss = new RegExp(/(?<=style=").+?(?=")/g); // Get only the content between style=" and the next ".
                const regexHtml = new RegExp(/(?=style=").+?(?=").(?<=style=").+?(?<=")/g); // Get the content from style=" to the next ".

                // TODO: Check also for ID or CLASS names not only TAGs.

                $button.on('click', (event) => {
                    let inputValue = $input.val();
                    if (inputValue) {
                        let cssItems = inputValue.match(regexCss);
                        let outputHtmlString = inputValue.replace(regexHtml, "");
                        let tagName = '';
                        let newCssOutput = [];

                        $outputHtml.val(outputHtmlString);

                        for(let a = 0; cssItems.length > a; a++) {
                            let cssItem = cssItems[a];
                            let currentItemIndex = inputValue.indexOf(cssItem) - 1; // -1 is needed to get the correct start item.

                            for (let a = currentItemIndex; a >= 0; a--) {
                                let newItemIndex = a;
                                let charAtIndex = inputValue.charAt(newItemIndex);

                                if (charAtIndex === '<') {
                                    let stringRange = inputValue.substr(newItemIndex + 1, newItemIndex + 10);
                                    let splittetStringRange = stringRange.split(' ');

                                    tagName = splittetStringRange[0];

                                    break;
                                }
                            }

                            // Create array with css attributes.
                            newCssOutput.push(tagName + ' {' + cssItem + ' }');
                        }

                        // Split array to a string without comma and with a line break.
                        $outputCss.val(newCssOutput.join("\n"));
                    }
                })
            });
        </script>
    </body>
</html>
